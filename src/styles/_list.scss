@use 'utils';
@use 'fonts';
@use 'theme';
@use 'variables';

$selector-padding: 15px;
$list-content-padding: 21px;
$icon-width: 42px; // 42 to align icons with dates

@mixin launch-animation {
  opacity: 0;
  animation-name: launch-animation;
  animation-delay: var(--launch-animation-offset);
  animation-duration: calc(variables.$launch-animation-time - var(--launch-animation-offset) * 1.1);
  animation-timing-function: cubic-bezier(.47,.14,.58,.79);
  animation-fill-mode: forwards;
}

.list {
  position: relative;
  transition: opacity 600ms;

  .list-item {
    @include fonts.main;
    color: theme.$primary;

    z-index: 0;

    height: 50px;
    width: 350px;

    display: flex;
    align-items: center;
    gap: variables.$universal-margin;

    @include utils.check-nested-parent-state('.list', '.selection-view') {
      position: absolute;
      transition:
        top 200ms ease-out,
        left 200ms ease-out,
        color 100ms ease-out,
        width 400ms;
    }

    @include utils.check-nested-parent-state('.list', '.being-reordered') {
      transition:
        top 200ms ease-out,
        left 200ms ease-out,
        color 100ms ease-out,
        width 400ms,
        z-index 200ms step-end;

      &:not(.reordered-item) {
        color: theme.$tertiary;
      }
    }

    &.reordered-item { // reordered by dragging
      z-index: 3;
      transition: none;
    }

    &.selected {
      z-index: 1; // when reordering with shortcut, selected item is on top of others
    }

    .launch-animation & {
      @include launch-animation;
    }

    &.complete {
      color: theme.$tertiary;
    }

    &.being-renamed {
      width: calc(350px + 3 * $icon-width + 3 * variables.$universal-margin);
    }

    .name, .error, .rename-form, .create-form, .placeholder, .streak {
      position: relative; // needs explicit position value to render over ::before element
      line-height: 38px; // needed to center text properly
    }

    .rename-form, .create-form {
      line-height: 22px; // slightly smaller looks better when highlighting
      height: 50px; // form height important for scrolling into view when being typed into
      display: flex;
      align-items: center;
    }

    .name, .error, .rename-form, .create-form, .placeholder {
      white-space: nowrap;
      overflow: hidden;
      flex-grow: 1;
      text-overflow: ellipsis;
    }

    .name, .error, .rename-form, .create-form, .placeholder {
      margin-left: $list-content-padding;
    }

    .create-form, .placeholder, .streak {
      margin-right: $list-content-padding;
    }

    .placeholder { // different than ::placeholder element, used in create habit form
      color: theme.$tertiary;
    }

    .input {
      width: 100%;

      &::placeholder {
        color: theme.$tertiary;
      }
    }

    .error {
      color: theme.$error;
    }

    &.selected:before { // list item selector
      content: '';
      position: absolute;
      height: 38px;
      left: calc($list-content-padding - $selector-padding);
      width: calc(350px - 2 * $list-content-padding + 2 * $selector-padding);
      border-radius: variables.$border-radius;
      background-color: theme.$background-active;
    }

    .launch-animation &.selected:before {
      display: none;
    }

    &:has(.list-item-error):before {
      background-color: theme.$background-error;
    }

    .icon-button {
      position: relative; // needs explicit position value to render over ::before element
      height: 38px;
      min-width: $icon-width;

      display: flex;
      justify-content: center;
      align-items: center;

      &:last-of-type {
        margin-right: calc((50px - $icon-width) / 2);
      }

      &.greyed-out {
        color: theme.$tertiary;
      }

      @include utils.check-nested-parent-state('.list', '.being-reordered') {
        &.move-icon {
          color: theme.$tertiary;
        }
      }

      &.hidden {
        display: none;
      }

      @include utils.check-nested-parent-state('.list-item', '.selected') {
        transition: opacity 300ms;

        @for $index from 0 through 3 {
          &:nth-of-type(#{1 + $index}) {
            transition-delay: $index * 75ms;
          }
        }
      }

      @include utils.check-nested-parent-state('.list-item', '.being-renamed') {
        @for $index from 0 through 3 {
          &:nth-of-type(#{4 - $index}) {
            transition-delay: $index * 50ms;
          }
        }

        &:not(.rename-icon) {
          opacity: 0;
        }
      }
    }
  }
}
