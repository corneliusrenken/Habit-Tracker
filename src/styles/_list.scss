@use 'fonts';
@use 'theme';
@use 'variables';

$selector-padding: 15px;
$list-content-padding: 21px;
$icon-width: 42px; // 42 to align icons with dates

@mixin list-launch {
  opacity: 0;
  animation-name: launch-animation;
  animation-delay: var(--launch-animation-offset);
  animation-duration: calc(variables.$launch-animation-time - var(--launch-animation-offset) * 1.1);
  animation-timing-function: cubic-bezier(.47,.14,.58,.79);
  animation-fill-mode: forwards;
}

.list {
  position: relative;
  transition: opacity 600ms;

  &-item {
    @include fonts.main;
    color: theme.$primary;

    position: relative;
    z-index: 0;

    height: 50px;
    width: 350px;

    display: flex;
    align-items: center;
    gap: variables.$universal-margin;

    .selection-view & {
      position: absolute;
      transition:
        top 200ms ease-out,
        left 200ms ease-out,
        color 100ms ease-out,
        width 400ms,
        z-index 200ms step-end;
    }

    .being-reordered &:not(.reordered-item) {
      color: theme.$tertiary;
    }

    &.reordered-item {
      z-index: 3;
      transition: none;
    }

    .launch-animation & {
      @include list-launch;
    }

    &.complete {
      color: theme.$tertiary;
    }

    &.being-renamed {
      width: calc(350px + 3 * $icon-width + 3 * variables.$universal-margin);
    }

    &-name, &-error, &-rename-form, &-create-form, &-placeholder, &-streak {
      position: relative; // needs explicit position value to render over ::before element
      line-height: 38px; // needed to center text properly
    }

    &-rename-form, &-create-form {
      line-height: 22px; // slightly smaller looks better when highlighting
      height: 50px; // form height important for scrolling into view when being typed into
      display: flex;
      align-items: center;
    }

    &-name, &-error, &-rename-form, &-create-form, &-placeholder {
      white-space: nowrap;
      overflow: hidden;
      flex-grow: 1;
      text-overflow: ellipsis;
    }

    &-name, &-error, &-rename-form, &-create-form, &-placeholder {
      margin-left: $list-content-padding;
    }

    &-create-form, &-placeholder, &-streak {
      margin-right: $list-content-padding;
    }

    &-placeholder { // different than ::placeholder element, used in create habit form
      color: theme.$tertiary;
    }

    &-input {
      padding-top: 1px;
      width: 100%;
      border-bottom: 1px solid theme.$primary;

      &::placeholder {
        color: theme.$tertiary;
      }

      // .list-item-create-form & {
      //   @keyframes input-width-expand {
      //     from {
      //       width: 33%;
      //     }

      //     to {
      //       width: 100%;
      //     }
      //   }

      //   animation: input-width-expand 400ms;
      // }
    }

    &-error {
      color: theme.$error;
    }

    &.selected:before { // list item selector
      content: '';
      position: absolute;
      height: 38px;
      left: calc($list-content-padding - $selector-padding);
      width: calc(350px - 2 * $list-content-padding + 2 * $selector-padding);
      border-radius: variables.$border-radius;
      background-color: theme.$background-active;
    }

    .launch-animation &.selected:before {
      display: none;
    }

    &-icon-button {
      position: relative; // needs explicit position value to render over ::before element
      height: 38px;
      min-width: $icon-width;

      display: flex;
      justify-content: center;
      align-items: center;

      &:last-of-type {
        margin-right: calc((50px - $icon-width) / 2);
      }

      &.greyed-out, .being-reordered &.move-icon {
        color: theme.$tertiary;
      }

      &.hidden {
        display: none;
      }

      .selected & {
        transition: opacity 300ms;

        @for $index from 0 through 3 {
          &:nth-of-type(#{1 + $index}) {
            transition-delay: $index * 75ms;
          }
        }
      }

      .being-renamed & {
        @for $index from 0 through 3 {
          &:nth-of-type(#{4 - $index}) {
            transition-delay: $index * 50ms;
          }
        }

        &:not(.rename-icon) {
          opacity: 0;
        }
      }
    }
  }
}
