@use 'fonts';
@use 'theme';
@use 'variables';

$selector-padding: 15px;
$list-content-padding: 21px;
$icon-width: 42px; // 42 to align icons with dates

@keyframes list-launch-animation {
  0% {
    filter: blur(7px);
  }

  100% {
    opacity: 1;
  }
}

@mixin list-launch {
  opacity: 0;
  animation-name: list-launch-animation;
  // animation-duration: 0.5 * variables.$launch-animation-time;
  animation-delay: var(--launch-animation-offset);
  animation-duration: calc(variables.$launch-animation-time - var(--launch-animation-offset) * 1.1);
  animation-timing-function: cubic-bezier(.47,.14,.58,.79);
  animation-fill-mode: forwards;
}

.list {
  transition: opacity 600ms;

  &-item {
    @include fonts.main;
    color: theme.$primary;

    height: 50px;
    width: 350px;

    display: flex;
    align-items: center;
    gap: variables.$universal-margin;

    .launch-animation & {
      @include list-launch;
    }

    &.complete {
      color: theme.$tertiary;
    }

    &.selected {
      transition: width 400ms;
    }

    &.being-renamed {
      width: calc(350px + 3 * $icon-width + 3 * variables.$universal-margin);
    }

    &-name, &-error, &-rename-form, &-create-form, &-placeholder, &-streak {
      position: relative; // needs explicit position value to render over ::before element
      line-height: 38px; // needed to center text properly
    }

    &-rename-form, &-create-form {
      line-height: 26px; // slightly smaller looks better when highlighting
    }

    &-name, &-error, &-rename-form, &-create-form, &-placeholder {
      white-space: nowrap;
      overflow: hidden;
      flex-grow: 1;
      text-overflow: ellipsis;
    }

    &-name, &-error, &-rename-form, &-create-form, &-placeholder {
      margin-left: $list-content-padding;
    }

    &-create-form, &-placeholder, &-streak {
      margin-right: $list-content-padding;
    }

    &-placeholder { // different than ::placeholder element, used in create habit form
      color: theme.$tertiary;
    }

    &-input {
      width: 100%;

      &::placeholder {
        color: theme.$tertiary;
      }
    }

    &-error {
      color: theme.$error;
    }

    &.selected:before { // list item selector
      content: '';
      position: absolute;
      height: 38px;
      left: calc($list-content-padding - $selector-padding);
      width: calc(350px - 2 * $list-content-padding + 2 * $selector-padding);
      border-radius: variables.$border-radius;
      background-color: theme.$background-active;
    }

    .launch-animation &.selected:before {
      display: none;
    }

    &-icon-button {
      position: relative; // needs explicit position value to render over ::before element
      height: 38px;
      min-width: $icon-width;

      display: flex;
      justify-content: center;
      align-items: center;

      &:last-of-type {
        margin-right: calc((50px - $icon-width) / 2);
      }

      &.greyed-out, .being-reordered &.move-icon {
        color: theme.$tertiary;
      }

      &.hidden {
        display: none;
      }

      .selected & {
        transition: opacity 300ms;

        @for $index from 0 through 3 {
          &:nth-of-type(#{1 + $index}) {
            transition-delay: $index * 75ms;
          }
        }
      }

      .being-renamed & {
        @for $index from 0 through 3 {
          &:nth-of-type(#{4 - $index}) {
            transition-delay: $index * 50ms;
          }
        }

        &:not(.rename-icon) {
          opacity: 0;
        }
      }
    }
  }
}
